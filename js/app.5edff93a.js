(function(e){function t(t){for(var r,c,o=t[0],i=t[1],u=t[2],p=0,d=[];p<o.length;p++)c=o[p],Object.prototype.hasOwnProperty.call(a,c)&&a[c]&&d.push(a[c][0]),a[c]=0;for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r]);l&&l(t);while(d.length)d.shift()();return s.push.apply(s,u||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],r=!0,o=1;o<n.length;o++){var i=n[o];0!==a[i]&&(r=!1)}r&&(s.splice(t--,1),e=c(c.s=n[0]))}return e}var r={},a={app:0},s=[];function c(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=e,c.c=r,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)c.d(n,r,function(t){return e[t]}.bind(null,r));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/myobu-chat/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],i=o.push.bind(o);o.push=t,o=o.slice();for(var u=0;u<o.length;u++)t(o[u]);var l=i;s.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"034f":function(e,t,n){"use strict";n("85ec")},"15e4":function(e,t,n){},"5aea":function(e,t,n){},"68f4":function(e,t,n){},"85ec":function(e,t,n){},"9cd6":function(e,t,n){"use strict";n("68f4")},a0a6:function(e,t,n){},a736:function(e,t,n){"use strict";n("a0a6")},baa3:function(e,t,n){"use strict";n("bb9d")},bb9d:function(e,t,n){},be0b:function(e,t,n){},c99b:function(e,t,n){"use strict";n("15e4")},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},s=[],c={},o=c,i=(n("034f"),n("2877")),u=Object(i["a"])(o,a,s,!1,null,null,null),l=u.exports,p=(n("d16e"),n("df25"),n("5aea"),n("f176"),n("e454"),n("8c4f")),d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"home-panel"}},[n("side-bar",{attrs:{workspaceId:e.workspaceId,selectedChannel:e.selectedChannel,connectionStatus:e.connectionStatus,peers:e.peers}}),n("chat-panel",{attrs:{workspaceId:e.workspaceId,selectedChannel:e.selectedChannel,ipfs:e.ipfs}})],1)},f=[],b=n("1da1"),h=(n("ac1f"),n("1276"),n("d3b7"),n("ddb0"),n("96cf"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"side-bar"}},[n("h3",[e._v("Myōbu Chat")]),n("hr"),e._m(0),e._m(1),n("div",{staticClass:"status"},[n("div",{class:{"status-ball":!0,relay:"RELAY"===e.connectionStatus,"direct-peers":"DIRECT_PEERS"===e.connectionStatus},attrs:{title:"RELAY"===e.connectionStatus?"Relay":"DIRECT_PEERS"===e.connectionStatus?"Direct Peers":"No Peers"}},[e._v(" ⬤ ")]),n("div",[e._v(e._s(e.peers.size)+" peer(s) online")])])])}),m=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",{staticClass:"section-title"},[n("strong",[e._v("Channels")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"channels"},[n("div",{staticClass:"channel-btn"},[e._v("# general")]),n("div",{staticClass:"channel-btn"},[e._v("+ Create/Join channel")])])}],v=n("329b"),w={name:"SideBar",props:{workspaceId:String,selectedChannel:String,connectionStatus:String,peers:v["a"].Set},mounted:function(){window.sidebar=this},data:function(){return{}},methods:{}},g=w,k=(n("a736"),Object(i["a"])(g,h,m,!1,null,null,null)),x=k.exports,C=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"chat-panel"}},[n("div",{staticClass:"top-bar"},[n("h4",{staticClass:"channel-name"},[e._v("# "+e._s(e.selectedChannel))])]),n("chat-messages"),n("text-box",{on:{"send-markdown":e.onSendMarkdown}})],1)},_=[],S=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"chat-messages"}},[e._v("Chat Messages")])},y=[],R={name:"ChatMessages",data:function(){return{}},methods:{}},E=R,O=(n("c99b"),Object(i["a"])(E,S,y,!1,null,"f11e9f32",null)),M=O.exports,P=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"text-box"}},[n("nav",[n("ul",{staticClass:"nav nav-tabs align-items-center",attrs:{id:"nav-tabs",role:"tablist"}},[n("li",{staticClass:"nav-item"},[n("a",{class:{"nav-link":!0,active:"MARKDOWN"===e.selectedTab},attrs:{"data-toggle":"tab",role:"tab","aria-controls":"markdown"},on:{click:function(t){e.selectedTab="MARKDOWN"}}},[e._v("Markdown")])]),n("li",{staticClass:"nav-item"},[n("a",{class:{"nav-link":!0,active:"PREVIEW"===e.selectedTab},attrs:{"data-toggle":"tab",role:"tab","aria-controls":"preview"},on:{click:function(t){e.selectedTab="PREVIEW"}}},[e._v("Preview")])]),n("li",{attrs:{id:"send-btn"}},[n("button",{staticClass:"btn btn-primary",on:{click:function(t){e.$emit("send-markdown",e.markdown)&&(e.markdown="")}}},[e._v(" Send ")])])])]),"MARKDOWN"===e.selectedTab?n("div",{staticClass:"form-group"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.markdown,expression:"markdown"}],staticClass:"form-control",attrs:{id:"markdown-input",rows:"6"},domProps:{value:e.markdown},on:{input:function(t){t.target.composing||(e.markdown=t.target.value)}}})]):n("div",{attrs:{id:"markdown-preview"},domProps:{innerHTML:e._s(e.html)}},[e._v(e._s(e.markdown))])])},T=[],j=n("d4cd"),A=n.n(j),I=n("362d"),D=n.n(I),B=n("e6f9"),$=n.n(B),K=n("cf2b"),N=n.n(K),W=n("4bb9"),G=n.n(W),U=n("54f6"),z=n.n(U),J=n("7ba6"),L=n.n(J),V=n("be03"),H=n.n(V),Y=new A.a({html:!0,linkify:!0,typographer:!1,breaks:!0});Y.use($.a),Y.use(H.a),Y.use(G.a),Y.use(N.a),Y.use(z.a),Y.use(L.a),Y.use(D.a);var F={name:"TextBox",data:function(){return{selectedTab:"MARKDOWN",markdown:""}},methods:{},computed:{html:function(){return Y.render(this.markdown)}}},q=F,Q=(n("9cd6"),Object(i["a"])(q,P,T,!1,null,"34c13014",null)),X=Q.exports,Z={name:"ChatPanel",props:{workspaceId:String,selectedChannel:String,ipfs:Object},components:{ChatMessages:M,TextBox:X},data:function(){return{messages:[]}},mounted:function(){},computed:{chatChannel:function(){return"global"}},methods:{onSendMarkdown:function(e){var t=this;return Object(b["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.ipfs){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,t.ipfs.pubsub.publish(t.chatChannel,e);case 4:console.log("sendMarkdown; ",t.chatChannel,e);case 5:case"end":return n.stop()}}),n)})))()}},watch:{chatChannel:function(e,t){var n=this;return Object(b["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n.ipfs){r.next=2;break}return r.abrupt("return");case 2:if(n.messages=[],!t){r.next=7;break}return r.next=6,n.ipfs.pubsub.unsubscribe(t);case 6:console.log("Unsubscribed from: ",t);case 7:return r.next=9,n.ipfs.pubsub.subscribe(e,n.receiveChatMessage);case 9:console.log("Subscribed to 2: ",n.chatChannel);case 10:case"end":return r.stop()}}),r)})))()},ipfs:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.ipfs){t.next=2;break}return t.abrupt("return");case 2:return e.messages=[],t.next=5,e.ipfs.pubsub.subscribe(e.chatChannel,e.receiveChatMessage);case 5:console.log("Subscribed to 1: ",e.chatChannel);case 6:case"end":return t.stop()}}),t)})))()},receiveChatMessage:function(e){var t=(new TextDecoder).decode(e.data);console.log("receiveChatMessage: ",e.from,t)}}},ee=Z,te=(n("d839"),Object(i["a"])(ee,C,_,!1,null,"78150d3b",null)),ne=te.exports,re={name:"Home",components:{SideBar:x,ChatPanel:ne},mounted:function(){var e=this;Object(b["a"])(regeneratorRuntime.mark((function t(){var n,r,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("Init IPFS: ",e.workspaceId),t.next=3,window.Ipfs.create({repo:e.workspaceId+Math.random(),relay:{enabled:!0,hop:{enabled:!0}},config:{Addresses:{Swarm:["/dns4/star.thedisco.zone/tcp/9090/wss/p2p-webrtc-star","/dns6/star.thedisco.zone/tcp/9090/wss/p2p-webrtc-star"]}}});case 3:return e.ipfs=t.sent,window.ipfs=e.ipfs,console.log("Setup IPFS"),t.next=8,e.dobootstrap(!1);case 8:return n=e.workspaceId+"-keepalive",t.next=11,e.ipfs.pubsub.subscribe(n);case 11:return console.log("Subscribed to ".concat(n," channel")),r=function(){var t=Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.ipfs.pubsub.publish(n,"1");case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),setInterval(r,4e3),r(),setInterval(e.checkAlive,1e3),a="announce-circuit",t.next=19,e.ipfs.pubsub.subscribe(a,e.processAnnounce);case 19:console.log("Subscribed to ".concat(a," channel")),s=function(){var t=Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.ipfs.pubsub.publish(a,e.peerAliveMessage);case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),setInterval(s,15e3),s(),window.home=e;case 24:case"end":return t.stop()}}),t)})))()},data:function(){return{peers:v["a"].Set(),lastAlive:0,lastPeer:0,lastBootstrap:0,bootstraps:["/dns6/ipfs.thedisco.zone/tcp/4430/wss/p2p/12D3KooWChhhfGdB9GJy1GbhghAAKCUR99oCymMEVS4eUcEy67nt","/dns4/ipfs.thedisco.zone/tcp/4430/wss/p2p/12D3KooWChhhfGdB9GJy1GbhghAAKCUR99oCymMEVS4eUcEy67nt"],workspaceId:"myobu-chat",selectedChannel:"general",connectionStatus:"NO_PEERS",ipfs:null,cleanPeerTimeout:{}}},computed:{peerAliveMessage:function(){return this.workspaceId+"-peer-alive"}},methods:{checkAlive:function(){var e=(new Date).getTime();e-this.lastAlive>=35e3?(e-this.lastPeer>=35e3?this.connectionStatus="NO_PEERS":this.connectionStatus="DIRECT_PEERS",this.dobootstrap(!0)):this.connectionStatus="RELAY"},processAnnounce:function(e){var t=this;return Object(b["a"])(regeneratorRuntime.mark((function n(){var r,a,s,c,o,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.ipfs.id();case 2:if(r=n.sent.id,e.from!=r){n.next=5;break}return n.abrupt("return");case 5:if(a=(new TextDecoder).decode(e.data),"peer-alive"!==a){n.next=8;break}return n.abrupt("return");case 8:if(a!=t.peerAliveMessage){n.next=14;break}return t.peers=t.peers.add(e.from),clearTimeout(t.cleanPeerTimeout[e.from]),t.cleanPeerTimeout[e.from]=setTimeout((function(){t.peers=t.peers.delete(e.from)}),15e3),t.lastPeer=(new Date).getTime(),n.abrupt("return");case 14:if(t.lastAlive=(new Date).getTime(),"keep-alive"!=a){n.next=17;break}return n.abrupt("return");case 17:if(s=a.split("/")[9],c=a,s!=r){n.next=21;break}return n.abrupt("return");case 21:return n.next=23,t.ipfs.swarm.peers();case 23:o=n.sent,n.t0=regeneratorRuntime.keys(o);case 25:if((n.t1=n.t0()).done){n.next=31;break}if(i=n.t1.value,o[i].peer!=s){n.next=29;break}return n.abrupt("return");case 29:n.next=25;break;case 31:return n.prev=31,n.next=34,t.ipfs.swarm.connect(c);case 34:n.next=41;break;case 36:return n.prev=36,n.t2=n["catch"](31),console.error(n.t2),n.next=41,t.ipfs.swarm.connect(c);case 41:case"end":return n.stop()}}),n,null,[[31,36]])})))()},dobootstrap:function(e){var t=this;return Object(b["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=(new Date).getTime(),!(r-t.lastBootstrap<6e4)){n.next=3;break}return n.abrupt("return");case 3:t.lastBootstrap=r,n.t0=regeneratorRuntime.keys(t.bootstraps);case 5:if((n.t1=n.t0()).done){n.next=24;break}if(a=n.t1.value,!e){n.next=18;break}return n.prev=8,n.next=11,t.ipfs.swarm.disconnect(t.bootstraps[a]);case 11:n.next=16;break;case 13:n.prev=13,n.t2=n["catch"](8),console.error(n.t2);case 16:n.next=20;break;case 18:return n.next=20,t.ipfs.bootstrap.add(t.bootstraps[a]);case 20:return n.next=22,t.ipfs.swarm.connect(t.bootstraps[a]);case 22:n.next=5;break;case 24:case"end":return n.stop()}}),n,null,[[8,13]])})))()}}},ae=re,se=(n("baa3"),Object(i["a"])(ae,d,f,!1,null,"be540778",null)),ce=se.exports;r["a"].use(p["a"]);var oe=[{path:"/",name:"Home",component:ce,meta:{title:"Myōbu | Chat"}},{path:"*",name:"catchAll",component:ce,meta:{title:"Myōbu | Chat"}}];console.log("BASE_URL","/myobu-chat/");var ie=new p["a"]({mode:"hash",base:"/myobu-chat/",routes:oe});ie.beforeEach((function(e,t,n){e.meta&&e.meta.title&&(document.title=e.meta.title),n()}));var ue=ie;r["a"].config.productionTip=!1,new r["a"]({render:function(e){return e(l)},router:ue}).$mount("#app")},d16e:function(e,t,n){},d839:function(e,t,n){"use strict";n("be0b")},df25:function(e,t,n){},e454:function(e,t,n){},f176:function(e,t,n){}});
//# sourceMappingURL=app.5edff93a.js.map